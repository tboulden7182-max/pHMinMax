<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>pH Min/Max Finder</title>
  <meta name="description" content="Upload a .txt/.csv and compute pH min/max quickly in the browser."/>
  <!-- Tailwind (CDN for GitHub Pages) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React 18 UMD + ReactDOM UMD -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <!-- PapaParse -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <style>
    body { background:#f8fafc; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script>
  (function(){
    const { useState, useMemo } = React;

    function Stat({ label, value }) {
      return React.createElement('div', { className: 'rounded-2xl bg-white shadow p-4 border' },
        React.createElement('div', { className: 'text-sm text-gray-500' }, label),
        React.createElement('div', { className: 'text-2xl font-semibold mt-1 break-all' }, String(value))
      );
    }

    function Pill({ children, tone }) {
      const toneMap = {
        gray: 'bg-gray-100 text-gray-800',
        amber: 'bg-amber-100 text-amber-800',
        red: 'bg-red-100 text-red-800',
        green: 'bg-green-100 text-green-800',
        blue: 'bg-blue-100 text-blue-800',
      };
      const klass = 'px-2 py-1 rounded-full text-xs font-medium ' + (toneMap[tone||'gray']||toneMap.gray);
      return React.createElement('span', { className: klass }, children);
    }

    function App(){
      const [file, setFile] = useState(null);
      const [rawText, setRawText] = useState('');
      const [hasHeader, setHasHeader] = useState(true);
      const [delimiterMode, setDelimiterMode] = useState('auto');
      const [customDelimiter, setCustomDelimiter] = useState('');
      const [selectedCol, setSelectedCol] = useState('');
      const [status, setStatus] = useState('');

      const parsed = useMemo(()=>{
        const txt = rawText;
        if(!txt || !txt.trim()) return { dataRows: [], headers: [], parseErrors: [] };
        let delimiter = undefined;
        if (delimiterMode === 'custom' && customDelimiter) delimiter = customDelimiter;
        if (delimiterMode !== 'auto' && delimiterMode !== 'custom') delimiter = delimiterMode;
        const result = Papa.parse(txt, {
          delimiter,
          skipEmptyLines: true,
          dynamicTyping: false,
        });
        let rows = result.data;
        const errors = result.errors || [];
        let hdrs = [];
        if(!rows.length) return { dataRows: [], headers: [], parseErrors: errors };
        if (hasHeader && rows.length > 0) {
          hdrs = rows[0].map((h, i) => (String(h||'').trim() || 'Column ' + (i+1)));
          rows = rows.slice(1);
        } else {
          const maxCols = Math.max.apply(null, rows.map(r => r.length));
          hdrs = Array.from({length:maxCols}, (_,i)=> 'Column ' + (i+1));
        }
        return { dataRows: rows, headers: hdrs, parseErrors: errors };
      }, [rawText, hasHeader, delimiterMode, customDelimiter]);

      const dataRows = parsed.dataRows;
      const headers = parsed.headers;
      const parseErrors = parsed.parseErrors;

      const stats = useMemo(()=>{
        if(!dataRows.length || !headers.length) return null;
        if(!selectedCol) return null;
        let colIndex = -1;
        const byIndex = String(selectedCol).startsWith('#');
        if(byIndex){
          colIndex = parseInt(String(selectedCol).replace('#',''), 10);
        } else {
          colIndex = headers.indexOf(selectedCol);
          if(colIndex === -1 && /^\d+$/.test(String(selectedCol))) colIndex = parseInt(selectedCol,10);
        }
        if(colIndex < 0) return null;
        const values = [];
        let nonNumeric = 0;
        let outOfRange = 0;
        for(const row of dataRows){
          const cell = row[colIndex];
          if(cell === undefined) continue;
          const v = parseFloat(String(cell).replace(/[^0-9.+-eE]/g, ''));
          if(!Number.isFinite(v)){ nonNumeric++; continue; }
          values.push(v);
          if(v < 0 || v > 14) outOfRange++;
        }
        if(!values.length) return { count: 0, min: null, max: null, mean: null, nonNumeric, outOfRange };
        const min = Math.min.apply(null, values);
        const max = Math.max.apply(null, values);
        const mean = values.reduce((a,b)=>a+b,0) / values.length;
        return { count: values.length, min, max, mean, nonNumeric, outOfRange };
      }, [dataRows, headers, selectedCol]);

      async function handleFile(e){
        const f = e.target.files && e.target.files[0];
        if(!f) return;
        setFile(f);
        setStatus('Reading file…');
        const text = await f.text();
        setRawText(text);
        setStatus('');
      }

      const sampleDetectedCols = useMemo(()=> dataRows.slice(0,5), [dataRows]);
      const columnOptions = headers.map((h,i)=> ({label: `${h} (#${i})`, value: h}));
      const indexOptions = headers.map((_,i)=> ({label: `#${i} (${headers[i]})`, value: `#${i}`}));

      return React.createElement('div', { className: 'min-h-screen bg-gray-50' },
        React.createElement('div', { className: 'mx-auto max-w-5xl p-6' },
          React.createElement('header', { className: 'mb-6 flex items-start justify-between gap-4' },
            React.createElement('h1', { className: 'text-2xl md:text-3xl font-bold tracking-tight' }, 'pH Min/Max Finder'),
            React.createElement('div', { className: 'flex items-center gap-2' },
              file ? React.createElement(Pill, { tone:'blue' }, 'Loaded: ' + file.name) : React.createElement(Pill, null, 'Awaiting file'),
              stats && stats.outOfRange ? React.createElement(Pill, { tone:'amber' }, String(stats.outOfRange) + ' values outside 0–14') : null,
              stats && stats.nonNumeric ? React.createElement(Pill, { tone:'red' }, String(stats.nonNumeric) + ' non‑numeric') : null
            )
          ),
          React.createElement('div', { className: 'grid md:grid-cols-3 gap-4 mb-6' },
            React.createElement('div', { className: 'md:col-span-2 rounded-2xl bg-white border shadow p-4' },
              React.createElement('label', { className: 'block text-sm font-medium mb-2' }, 'Upload .txt/.csv'),
              React.createElement('input', { type:'file', accept:'.txt,.csv,.tsv,.log,text/plain', onChange: handleFile,
                className: 'block w-full text-sm file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100'
              }),
              React.createElement('p', { className: 'text-xs text-gray-500 mt-2' }, 'Supports comma, tab, pipe, semicolon, or space‑delimited text. Headers optional.'),
              status ? React.createElement('p', { className: 'text-sm text-gray-600 mt-2' }, status) : null
            ),
            React.createElement('div', { className: 'rounded-2xl bg-white border shadow p-4' },
              React.createElement('label', { className: 'block text-sm font-medium mb-2' }, 'Header row'),
              React.createElement('div', { className: 'flex items-center gap-3' },
                React.createElement('input', { id:'hdr', type:'checkbox', checked:hasHeader, onChange:(e)=>setHasHeader(e.target.checked) }),
                React.createElement('label', { htmlFor:'hdr', className: 'text-sm' }, 'First row contains column names')
              ),
              React.createElement('label', { className: 'block text-sm font-medium mt-4 mb-2' }, 'Delimiter'),
              React.createElement('select', { value:delimiterMode, onChange:(e)=>setDelimiterMode(e.target.value), className:'w-full rounded-lg border px-3 py-2 text-sm' },
                React.createElement('option', { value:'auto' }, 'Auto-detect'),
                React.createElement('option', { value:',' }, 'Comma (,)'),
                React.createElement('option', { value:'\t' }, 'Tab (\t)'),
                React.createElement('option', { value:'|' }, 'Pipe (|)'),
                React.createElement('option', { value:';' }, 'Semicolon (;)'),
                React.createElement('option', { value:' ' }, 'Space ( )'),
                React.createElement('option', { value:'custom' }, 'Custom…')
              ),
              delimiterMode === 'custom' ? React.createElement('input', { type:'text', placeholder:'Enter single-character delimiter', value:customDelimiter, maxLength:2,
                onChange:(e)=>setCustomDelimiter(e.target.value), className:'mt-2 w-full rounded-lg border px-3 py-2 text-sm' }) : null
            )
          ),
          React.createElement('div', { className: 'grid md:grid-cols-3 gap-4 mb-6' },
            React.createElement('div', { className:'rounded-2xl bg-white border shadow p-4 md:col-span-2' },
              React.createElement('label', { className:'block text-sm font-medium mb-2' }, 'Select pH column'),
              headers.length ? React.createElement('div', { className:'flex flex-col md:flex-row gap-2' },
                React.createElement('select', { value:selectedCol, onChange:(e)=>setSelectedCol(e.target.value), className:'rounded-lg border px-3 py-2 text-sm w-full md:w-1/2' },
                  React.createElement('option', { value:'' }, '— choose by name —'),
                  columnOptions.map(opt => React.createElement('option', { key: opt.value, value: opt.value }, opt.label))
                ),
                React.createElement('select', { value: String(selectedCol).startsWith('#') ? selectedCol : '', onChange:(e)=>setSelectedCol(e.target.value),
                  className:'rounded-lg border px-3 py-2 text-sm w-full md:w-1/2' },
                  React.createElement('option', { value:'' }, '— or choose by index —'),
                  indexOptions.map(opt => React.createElement('option', { key: opt.value, value: opt.value }, opt.label))
                )
              ) : React.createElement('p', { className:'text-sm text-gray-500' }, 'Upload a file to populate columns.'),
              sampleDetectedCols.length ? React.createElement('div', { className:'mt-4 text-xs' },
                React.createElement('div', { className:'font-medium text-gray-600 mb-1' }, 'Preview (first 5 rows):'),
                React.createElement('div', { className:'overflow-auto border rounded-lg' },
                  React.createElement('table', { className:'min-w-full text-left' },
                    React.createElement('thead', null,
                      React.createElement('tr', null,
                        headers.map((h,i)=> React.createElement('th', { key:i, className:'px-3 py-2 bg-gray-50 border-b text-gray-700 whitespace-nowrap' }, h))
                      )
                    ),
                    React.createElement('tbody', null,
                      sampleDetectedCols.map((r,ri)=>
                        React.createElement('tr', { key:ri, className:'odd:bg-white even:bg-gray-50' },
                          headers.map((_,ci)=> React.createElement('td', { key:ci, className:'px-3 py-1 border-b whitespace-nowrap' }, (r && r[ci])||'' ))
                        )
                      )
                    )
                  )
                )
              ) : null
            ),
            React.createElement('div', { className:'rounded-2xl bg-white border shadow p-4 flex flex-col gap-3' },
              React.createElement('div', { className:'text-sm text-gray-600' }, 'Results'),
              React.createElement(Stat, { label:'Count (numeric)', value:(stats && stats.count) || 0 }),
              React.createElement(Stat, { label:'Min pH', value: stats && stats.min != null ? stats.min : '—' }),
              React.createElement(Stat, { label:'Max pH', value: stats && stats.max != null ? stats.max : '—' }),
              React.createElement(Stat, { label:'Mean (optional)', value: stats && stats.mean != null ? stats.mean.toFixed(3) : '—' }),
              parseErrors && parseErrors.length ? React.createElement('div', { className:'text-xs text-amber-700 bg-amber-50 border border-amber-200 rounded-lg p-2' },
                'Detected ' + parseErrors.length + ' parse warning(s). Consider setting the delimiter explicitly.'
              ) : null
            )
          ),
          React.createElement('footer', { className:'text-xs text-gray-500 mt-8' },
            'Tip: If your .txt uses fixed-width spacing or unusual separators, choose a custom delimiter or preprocess your file to add a consistent delimiter.'
          )
        )
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(React.createElement(App));
  })();
  </script>
</body>
</html>
